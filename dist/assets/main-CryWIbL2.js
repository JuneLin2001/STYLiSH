import"./modulepreload-polyfill-B5Qt9EMX.js";const C={method:"GET",redirect:"follow"},l="https://api.appworks-school.tw/api/1.0/products",f={women:`${l}/women`,men:`${l}/men`,accessories:`${l}/accessories`,logo:`${l}/all`},u=document.querySelector(".products-list"),y=document.getElementById("search-btn-mobile"),a=document.querySelector(".search"),E=document.querySelector("#logo"),L=document.querySelector(".header-right");let b=0,i=!0;document.getElementById("women").addEventListener("click",m);document.getElementById("men").addEventListener("click",m);document.getElementById("accessories").addEventListener("click",m);document.querySelector("#logo").addEventListener("click",m);document.getElementById("search-btn").addEventListener("click",M);document.getElementById("search-btn-mobile").addEventListener("click",k);document.addEventListener("click",k);function m(e){i=!0;const o=e.target.id,t=f[o];history.pushState({url:t},"",o==="logo"?".":`?category=${o}`),document.querySelector(".products-list").innerHTML="",n(t,!1)}function $(){const e=new URLSearchParams(window.location.search),s=e.get("category")||"logo",o=e.get("search");let t;return o?t=`${l}/search?keyword=${o}`:t=f[s]||f.logo,t}function n(e,s=!0){const o=s?`${e}?paging=${b}`:e;console.log("Fetching data from:",o),u.insertAdjacentHTML("beforeend",'<div class="loading-message"><h1>Loading</h1><br /><img src="./images/loading.gif" style="width:200px" /></div>'),i&&v(o).then(t=>{t.data.length===0?(i=!1,u.insertAdjacentHTML("beforeend",'<h1 style="grid-column: 1 / -1; margin: 0 auto;">查無結果</h1>'),document.querySelectorAll(".loading-message").forEach(r=>r.remove()),u.insertAdjacentHTML()):(I(t),document.querySelectorAll(".loading-message").forEach(r=>r.remove()),t.next_paging===void 0?i=!1:b=t.next_paging)})}window.addEventListener("load",()=>{const e=$();n(e,!e.includes("search")&&!e.includes("category")),T()});window.addEventListener("popstate",e=>{e.state&&e.state.url&&n(e.state.url,!e.state.url.includes("search")&&!e.state.url.includes("category"))});function M(){const e=document.getElementById("search-value").value.trim();if(e===""){alert("請輸入關鍵字！");return}else{const s=`${l}/search?keyword=${e}`;history.pushState({},"",`?search=${e}`),n(s,!1)}}function k(e){e.target===y?(a.style.display="block",y.style.display="none",E.style.display="none",L.style.display="flex",a.classList.toggle("search-mobile")):window.matchMedia("(max-width: 1279px)").matches&&!a.contains(e.target)&&(a.classList.remove("search-mobile"),a.style.display="none",y.style.display="flex",E.style.display="flex",L.style.display="none")}function v(e){return fetch(e,C).then(s=>s.json()).catch(s=>{console.error("Fetch error:",s)})}function I(e){const s=e.data;let o="";s.forEach(t=>{let r="";t.colors.forEach(w=>{r+=`<li style="background-color: #${w.code};"></li>`}),o+=`
      <li class="products ${t.category}">
      <a href= /product.html?id=${t.id}>
          <img class="product-img" src="${t.main_image}" alt="${t.title}"/>
          <ul class="product-color">${r}</ul>
          <p class="product-name">${t.title}</p>
          <p class="product-price">TWD.${t.price}</p>
          </a>
      </li>`}),u.insertAdjacentHTML("beforeend",o)}function A(){if(window.innerHeight+window.scrollY>=document.body.offsetHeight&&i){const e=$();n(e,!e.includes("search")&&!e.includes("category"))}}setInterval(A,500);let d=0;function S(e){p(),setInterval(()=>{d=(d+1)%e,p()},5e3)}function p(){const e=document.querySelectorAll(".carousel-item"),s=document.querySelectorAll(".carousel-dot");e.forEach((o,t)=>{t===d?o.classList.add("active"):o.classList.remove("active")}),s.forEach((o,t)=>{t===d?(o.style.backgroundColor="#8B572A",o.style.opacity="1"):(o.style.backgroundColor="#FFFFFF",o.style.opacity="0.4")})}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".carousel-item").length;e>0&&S(e)});window.addEventListener("popstate",e=>{e.state&&e.state.url&&n(e.state.url,!1)});function B(e){let s="";const o=e.data;o.forEach((c,g)=>{const h=c.story.split(/\r\n|\n/),q=h.slice(0,-1).join("<br />"),x=h[h.length-1];s+=`<div class="carousel-item" id="item-${g}">
      <a href= /product.html?id=${c.product_id}>
      <img src="${c.picture}" />
      <div class="carousel-title-container">
        <p class="carousel-title">
          ${q}
          <br />
          <span class="carousel-subtitle">${x}</span>
        </p>
      </div>
      </a>
    </div>`});let t='<ul class="carousel-dots">';for(let c=0;c<o.length;c++)t+='<li class="carousel-dot"></li>';t+="</ul>",s+=t,document.querySelector("#carousel").insertAdjacentHTML("beforeend",s),document.querySelectorAll(".carousel-dot").forEach((c,g)=>{c.addEventListener("click",()=>{d=g,p()})}),S(o.length)}function T(){const s=(JSON.parse(localStorage.getItem("cart"))||[]).reduce((o,t)=>o+(t.quantity||0),0);document.querySelector(".cart-num").textContent=s,document.querySelector(".footer-cart-num").textContent=s}const D="https://api.appworks-school.tw/api/1.0/marketing/campaigns";v(D).then(e=>{B(e)});
